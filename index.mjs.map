{"version":3,"file":"index.mjs","sources":["../lib/main.js","../lib/defaults.js","../lib/validate.js"],"sourcesContent":["/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nimport hasOwnProp from '@stdlib/assert-has-own-property';\nimport isObject from '@stdlib/assert-is-plain-object';\nimport { isPrimitive as isPositiveInteger } from '@stdlib/assert-is-positive-integer';\nimport { isPrimitive as isBoolean } from '@stdlib/assert-is-boolean';\nimport incrminmax from '@stdlib/stats-incr-minmax';\nimport incrmeanstdev from '@stdlib/stats-incr-meanstdev';\nimport setReadOnly from '@stdlib/utils-define-read-only-property';\nimport setReadOnlyAccessor from '@stdlib/utils-define-read-only-accessor';\nimport max from '@stdlib/math-base-special-max';\nimport sqrt from '@stdlib/math-base-special-sqrt';\nimport roundn from '@stdlib/math-base-special-roundn';\nimport tQuantile from '@stdlib/stats-base-dists-t-quantile';\nimport format from '@stdlib/error-tools-fmtprodmsg';\nimport validate from './validate.js';\nimport defaults from './defaults.js';\n\n\n// MAIN //\n\n/**\n* Returns an accumulator function which incrementally performs Grubbs' test for detecting outliers.\n*\n* @param {Options} [options] - function options\n* @param {number} [options.alpha=0.05] - significance level\n* @param {string} [options.alternative='two-sided'] - alternative hypothesis ('two-sided', 'min', 'max')\n* @param {NonNegativeInteger} [options.init=100] - number of data points used to compute initial statistics\n* @throws {TypeError} options argument must be an object\n* @throws {TypeError} must provide valid options\n* @throws {RangeError} `alpha` option must be on the interval `[0,1]`\n* @returns {Function} accumulator function\n*\n* @example\n* import rnorm from '@stdlib/random-base-normal';\n*\n* var accumulator;\n* var opts;\n* var res;\n* var i;\n*\n* opts = {\n*     'init': 100\n* };\n*\n* accumulator = incrgrubbs( opts );\n*\n* for ( i = 0; i < 200; i++ ) {\n*     res = accumulator( rnorm( 10.0, 5.0 ) );\n* }\n*/\nfunction incrgrubbs() {\n\tvar meanstdev;\n\tvar results;\n\tvar minmax;\n\tvar opts;\n\tvar err;\n\tvar mm;\n\tvar ms;\n\tvar gc;\n\tvar df;\n\tvar N;\n\tvar G;\n\n\topts = defaults();\n\tif ( arguments.length ) {\n\t\terr = validate( opts, arguments[ 0 ] );\n\t\tif ( err ) {\n\t\t\tthrow err;\n\t\t}\n\t}\n\t// Initialize the results object:\n\tresults = {};\n\tsetReadOnlyAccessor( results, 'rejected', getRejected );\n\tsetReadOnly( results, 'alpha', opts.alpha );\n\tsetReadOnlyAccessor( results, 'criticalValue', getCriticalValue );\n\tsetReadOnlyAccessor( results, 'statistic', getStatistic );\n\tsetReadOnlyAccessor( results, 'df', getDOF );\n\tsetReadOnlyAccessor( results, 'mean', getMean );\n\tsetReadOnlyAccessor( results, 'sd', getStDev );\n\tsetReadOnlyAccessor( results, 'min', getMin );\n\tsetReadOnlyAccessor( results, 'max', getMax );\n\tsetReadOnly( results, 'alt', opts.alternative );\n\tsetReadOnly( results, 'method', 'Grubbs\\' Test' );\n\tsetReadOnly( results, 'print', print );\n\n\tN = 0;\n\tdf = 0;\n\tG = 0.0;\n\tgc = 0.0;\n\n\t// Initialize statistics accumulators:\n\tmm = [ 0.0, 0.0 ];\n\tminmax = incrminmax( mm );\n\n\tms = [ 0.0, 0.0 ];\n\tmeanstdev = incrmeanstdev( ms );\n\n\treturn accumulator;\n\n\t/**\n\t* If provided a value, the accumulator function returns updated Grubbs' test results. If not provided a value, the accumulator function returns the current Grubbs' test results.\n\t*\n\t* @private\n\t* @param {number} [x] - new value\n\t* @returns {(Object|null)} test results or null\n\t*/\n\tfunction accumulator( x ) {\n\t\tvar sig;\n\t\tvar md;\n\t\tvar tc;\n\t\tif ( arguments.length === 0 ) {\n\t\t\tif ( N < opts.init || df <= 0 ) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\tN += 1;\n\n\t\t// Update model statistics:\n\t\tmeanstdev( x );\n\t\tminmax( x );\n\n\t\t// Compute the degrees of freedom:\n\t\tdf = N - 2;\n\n\t\tif ( N < opts.init || df <= 0 ) {\n\t\t\treturn null;\n\t\t}\n\t\t// Compute the test statistic and significance level...\n\t\tif ( opts.alternative === 'min' ) {\n\t\t\tG = ( ms[0]-mm[0] ) / ms[ 1 ];\n\t\t\tsig = opts.alpha / N;\n\t\t} else if ( opts.alternative === 'max' ) {\n\t\t\tG = ( mm[1]-ms[0] ) / ms[ 1 ];\n\t\t\tsig = opts.alpha / N;\n\t\t} else { // two-sided\n\t\t\tmd = max( ms[0]-mm[0], mm[1]-ms[0] ); // maximum absolute deviation\n\t\t\tG = md / ms[ 1 ];\n\t\t\tsig = opts.alpha / (2*N);\n\t\t}\n\t\t// Compute the critical values:\n\t\ttc = tQuantile( 1.0-sig, df );\n\t\tgc = (N-1)*tc / sqrt( N*(df+(tc*tc)) );\n\n\t\treturn results;\n\t}\n\n\t/**\n\t* Returns a `boolean` indicating whether the null hypothesis should be rejected.\n\t*\n\t* @private\n\t* @returns {boolean} boolean indicating whether the null hypothesis should be rejected\n\t*/\n\tfunction getRejected() {\n\t\treturn ( G > gc );\n\t}\n\n\t/**\n\t* Returns the critical value.\n\t*\n\t* @private\n\t* @returns {number} critical value\n\t*/\n\tfunction getCriticalValue() {\n\t\treturn gc;\n\t}\n\n\t/**\n\t* Returns the test statistic.\n\t*\n\t* @private\n\t* @returns {number} test statistic\n\t*/\n\tfunction getStatistic() {\n\t\treturn G;\n\t}\n\n\t/**\n\t* Returns the degrees of freedom (DOF).\n\t*\n\t* @private\n\t* @returns {PositiveInteger} degrees of freedom\n\t*/\n\tfunction getDOF() {\n\t\treturn df;\n\t}\n\n\t/**\n\t* Returns the sample mean.\n\t*\n\t* @private\n\t* @returns {number} sample mean\n\t*/\n\tfunction getMean() {\n\t\treturn ms[ 0 ];\n\t}\n\n\t/**\n\t* Returns the corrected sample standard deviation.\n\t*\n\t* @private\n\t* @returns {number} corrected sample standard deviation\n\t*/\n\tfunction getStDev() {\n\t\treturn ms[ 1 ];\n\t}\n\n\t/**\n\t* Returns the sample minimum.\n\t*\n\t* @private\n\t* @returns {number} sample minimum\n\t*/\n\tfunction getMin() {\n\t\treturn mm[ 0 ];\n\t}\n\n\t/**\n\t* Returns the sample maximum.\n\t*\n\t* @private\n\t* @returns {number} sample maximum\n\t*/\n\tfunction getMax() {\n\t\treturn mm[ 1 ];\n\t}\n\n\t/**\n\t* Pretty-print test results.\n\t*\n\t* @private\n\t* @param {Object} [options] - options object\n\t* @param {PositiveInteger} [options.digits=4] - number of digits after the decimal point\n\t* @param {boolean} [options.decision=true] - boolean indicating whether to print the test decision\n\t* @throws {TypeError} options argument must be an object\n\t* @throws {TypeError} must provide valid options\n\t* @returns {string} formatted output\n\t*/\n\tfunction print( options ) {\n\t\tvar decision;\n\t\tvar digits;\n\t\tvar str;\n\n\t\tdigits = opts.digits;\n\t\tdecision = opts.decision;\n\t\tif ( arguments.length > 0 ) {\n\t\t\tif ( !isObject( options ) ) {\n\t\t\t\tthrow new TypeError( format( '1HN47', options ) );\n\t\t\t}\n\t\t\tif ( hasOwnProp( options, 'digits' ) ) {\n\t\t\t\tif ( !isPositiveInteger( options.digits ) ) {\n\t\t\t\t\tthrow new TypeError( format( '1HN3P', 'digits', options.digits ) );\n\t\t\t\t}\n\t\t\t\tdigits = options.digits;\n\t\t\t}\n\t\t\tif ( hasOwnProp( options, 'decision' ) ) {\n\t\t\t\tif ( !isBoolean( options.decision ) ) {\n\t\t\t\t\tthrow new TypeError( format( '1HN2o', 'decision', options.decision ) );\n\t\t\t\t}\n\t\t\t\tdecision = options.decision;\n\t\t\t}\n\t\t}\n\t\tstr = '';\n\t\tstr += results.method;\n\t\tstr += '\\n\\n';\n\t\tstr += 'Alternative hypothesis: ';\n\t\tif ( opts.alternative === 'max' ) {\n\t\t\tstr += 'The maximum value (' + mm[ 1 ] + ') is an outlier';\n\t\t} else if ( opts.alternative === 'min' ) {\n\t\t\tstr += 'The minimum value (' + mm[ 0 ] + ') is an outlier';\n\t\t} else { // two-sided\n\t\t\tstr += 'The ';\n\t\t\tif ( ms[0]-mm[0] > mm[1]-ms[0] ) {\n\t\t\t\tstr += 'minimum value (' + mm[ 0 ] + ')';\n\t\t\t} else {\n\t\t\t\tstr += 'maximum value (' + mm[ 1 ] + ')';\n\t\t\t}\n\t\t\tstr += ' is an outlier';\n\t\t}\n\t\tstr += '\\n\\n';\n\t\tstr += '    criticalValue: ' + roundn( gc, -digits ) + '\\n';\n\t\tstr += '    statistic: ' + roundn( G, -digits ) + '\\n';\n\t\tstr += '    df: ' + df + '\\n';\n\t\tstr += '\\n';\n\t\tif ( decision ) {\n\t\t\tstr += 'Test Decision: ';\n\t\t\tif ( G > gc ) {\n\t\t\t\tstr += 'Reject null in favor of alternative at ' + (opts.alpha*100.0) + '% significance level';\n\t\t\t} else {\n\t\t\t\tstr += 'Fail to reject null in favor of alternative at ' + (opts.alpha*100.0) + '% significance level';\n\t\t\t}\n\t\t\tstr += '\\n';\n\t\t}\n\t\treturn str;\n\t}\n}\n\n\n// EXPORTS //\n\nexport default incrgrubbs;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2023 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MAIN //\n\n/**\n* Returns default options.\n*\n* @private\n* @returns {Object} default options\n*\n* @example\n* var o = defaults();\n* // returns {...}\n*/\nfunction defaults() {\n\treturn {\n\t\t'init': 100,\n\t\t'alpha': 0.05,\n\t\t'alternative': 'two-sided',\n\t\t'digits': 4,\n\t\t'decision': true\n\t};\n}\n\n\n// EXPORTS //\n\nexport default defaults;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nimport hasOwnProp from '@stdlib/assert-has-own-property';\nimport isObject from '@stdlib/assert-is-plain-object';\nimport { isPrimitive as isNumber } from '@stdlib/assert-is-number';\nimport { isPrimitive as isString } from '@stdlib/assert-is-string';\nimport { isPrimitive as isNonNegativeInteger } from '@stdlib/assert-is-nonnegative-integer';\nimport format from '@stdlib/error-tools-fmtprodmsg';\nimport isnan from '@stdlib/assert-is-nan';\n\n\n// MAIN //\n\n/**\n* Validates function options.\n*\n* @private\n* @param {Object} opts - destination for validated options\n* @param {Options} options - function options\n* @param {number} [options.alpha] - significance level\n* @param {string} [options.alternative] - alternative hypothesis\n* @param {NonNegativeInteger} [options.init] - number of data points used to compute initial statistics\n* @returns {(null|Error)} null or an error\n*\n* @example\n* var opts = {};\n*\n* var options = {\n*     'alpha': 0.05,\n*     'alternative': 'two-sided',\n*     'init': 100\n* };\n*\n* var err = validate( opts, options );\n* if ( err ) {\n*     throw err;\n* }\n*/\nfunction validate( opts, options ) {\n\tif ( !isObject( options ) ) {\n\t\treturn new TypeError( format( '1HN2V', options ) );\n\t}\n\tif ( hasOwnProp( options, 'alpha' ) ) {\n\t\topts.alpha = options.alpha;\n\t\tif ( !isNumber( opts.alpha ) || isnan( opts.alpha ) ) {\n\t\t\treturn new TypeError( format( '1HN8P', 'alpha', opts.alpha ) );\n\t\t}\n\t\tif ( opts.alpha < 0.0 || opts.alpha > 1.0 ) {\n\t\t\treturn new RangeError( format( '1HN8V', 'alpha', opts.alpha ) );\n\t\t}\n\t}\n\tif ( hasOwnProp( options, 'alternative' ) ) {\n\t\topts.alternative = options.alternative;\n\t\tif ( !isString( opts.alternative ) ) {\n\t\t\treturn new TypeError( format( '1HN2W', 'alternative', opts.alternative ) );\n\t\t}\n\t}\n\tif ( hasOwnProp( options, 'init' ) ) {\n\t\topts.init = options.init;\n\t\tif ( !isNonNegativeInteger( opts.init ) ) {\n\t\t\treturn new TypeError( format( '1HN2t', 'init', opts.init ) );\n\t\t}\n\t}\n\treturn null;\n}\n\n\n// EXPORTS //\n\nexport default validate;\n"],"names":["incrgrubbs","meanstdev","results","minmax","opts","err","mm","ms","gc","df","N","G","init","alpha","alternative","digits","decision","arguments","length","options","isObject","TypeError","format","hasOwnProp","isNumber","isnan","RangeError","isString","isNonNegativeInteger","validate","setReadOnlyAccessor","setReadOnly","str","isPositiveInteger","isBoolean","method","roundn","incrminmax","incrmeanstdev","x","sig","md","tc","max","tQuantile","sqrt"],"mappings":"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"}